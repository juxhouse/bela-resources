# Client-Controlled Deployment
(AKA "On-Premisses", AKA "Bring Your Own Cloud")

With an enterprise account you can deploy BELA as a container in your own environment.

## Required Resources

Determine the required CPU, RAM, and disk resources for the BELA container using this simple [calculator](https://bela.live/container-sizing).

## BELA Data Volume

Provide a host directory to store all BELA's files. This directory must provide durability equivalent to Amazon EFS and must have a backup procedure enabled.

Set an env var with the path to the host directory, for example:

```bash
   HOST_DIRECTORY=\my-host-directory
```

Make sure the host directory is accessible to the BELA container:

```bash
   chgrp -R 0 $HOST_DIRECTORY  &&  chmod -R g+rwX $HOST_DIRECTORY
```
This allows the BELA container to run with a non-root user, in a way that is compatible with Docker, Kubernetes and OpenShift with its random user ids.

This host directory will be mounted it as volume `\bela-data` in the BELA container.

> [!CAUTION]
> **The container must be configured as a single instance.** No more than one container can access the same file directory. The container cannot be configured for horizontal scaling. On Kubernetes, Openshift, etc, use the ReadWriteOnce access mode.

## Example Docker Command

```bash
# Log in to Docker hub
echo "$BELA_DOCKERHUB_TOKEN" | docker login -u juxhouse --password-stdin

# Start the BELA container
docker run --pull=always \
           -v /my-host-directory:/bela-data \
           -p 8081:8081 \
           juxhouse/bela
```

## Configure BELA

Configure access control and API integrations using the .bela-properties file.


## Single Sign-On (SSO)

You can activate SSO in BELA using OAuth2 OpenID (not SAML).

1. Register BELA as an application with your SSO provider. Use this as the redirect URI: `https://{your-bela-host}/callback`

Examples for some popular providers:
- [Google](/reference/SSO-Google.md)
- [Microsoft Entra ID](/reference/SSO-Microsoft-Entra-ID.md)
- [Okta](/reference/SSO-Okta.md)

2. Add the following properties to the [bela.properties](/reference/bela.properties.md) file:

|Property|Value|
|--------|-----|
| openid.client.id | The client id for BELA generated by your SSO provider above.
| openid.client.secret | The client secret for BELA generated by your SSO provider above.
| openid.configuration.url | The configuration URL for your SSO provider. It follows the pattern: `https://{host}/.well-known/openid-configuration`

## Set File Ownership to the BELA User

The BELA container runs with a restricted, non-root user with user ID and group ID `1000000042`. The mounted directory must have its UID and GID set accordingly:

```bash
sudo chown -R 1000000042:1000000042 /directory/to/mount
```


