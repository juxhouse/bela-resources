# Client-Controlled Deployment
(AKA "On-Premisses", AKA "Bring Your Own Cloud")

With an enterprise account you can deploy BELA as a container in your own environment.

## Required Resources

Determine the required CPU, RAM, and disk resources for the BELA container using this simple [calculator](https://bela.live/container-sizing).

## BELA Data Volume

Provide a host directory to store all BELA's files. This directory must provide durability equivalent to Amazon EFS and must have a backup procedure enabled.

Make the host directory accessible to the BELA container user:
```bash
   HOST_DIRECTORY=\my-host-directory
   chgrp -R 0 $HOST_DIRECTORY  &&  chmod -R g+rwX $HOST_DIRECTORY
```
This allows the BELA container to run with a non-root user, in a way that is compatible with Docker, Kubernetes and OpenShift with its random user ids.

This host directory will be mounted it as volume `\bela-data` in the BELA container.

> [!CAUTION]
> **The container must be configured as a single instance.** No more than one container can access the same file directory. The container cannot be configured for horizontal scaling. On Kubernetes, Openshift, etc, use the ReadWriteOnce access mode.

## Starting the BELA Container

This is a minimal example using Docker.

Log in to Docker Hub using the `BELA_DOCKERHUB_TOKEN` provided with your BELA Enterprise account.

```bash
echo "$BELA_DOCKERHUB_TOKEN" | docker login -u juxhouse --password-stdin
```

Start the BELA container.

```
docker run --pull=always \
           -v $HOST_DIRECTORY:/bela-data \
           -p 8081:8081 \
           juxhouse/bela
```

## Configure DNS and SSL

Configure DNS to point to the host of the BELA container. BELA is tested with IPv4.

Make it an easy subdomain such as `bela.company.com`. If you make it an obscure host name, people will not remember it and that will defeat the purpose of the tool.

BELA serves plain HTTP on port 8081. Configure your reverse-proxy on the host to accept SSL connections using the default port (443) and forward them to BELA's HTTP port 8081.

BELA should now be accessible by HTTPS on the domain you configured.


## Configure BELA

When you run BELA for the first time, this file will be created in your host directory, mentioned above:
```bash
   config\bela.properties
```

Configure access control and API integrations using the .bela-properties file.

Restart the BELA container.

## Troubleshooting

Your host directory, mentioned above, will contain a logs folder with logs from BELA executions. It can provide error messages and insight.

Your BELA Enterprise account gives your BELA admins access to the BELA team by popular instant messaging apps.




## Single Sign-On (SSO)

You can activate SSO in BELA using OAuth2 OpenID (not SAML).

1. Register BELA as an application with your SSO provider. Use this as the redirect URI: `https://{your-bela-host}/callback`

Examples for some popular providers:
- [Google](/reference/SSO-Google.md)
- [Microsoft Entra ID](/reference/SSO-Microsoft-Entra-ID.md)
- [Okta](/reference/SSO-Okta.md)

2. Add the following properties to the [bela.properties](/reference/bela.properties.md) file:

|Property|Value|
|--------|-----|
| openid.client.id | The client id for BELA generated by your SSO provider above.
| openid.client.secret | The client secret for BELA generated by your SSO provider above.
| openid.configuration.url | The configuration URL for your SSO provider. It follows the pattern: `https://{host}/.well-known/openid-configuration`



